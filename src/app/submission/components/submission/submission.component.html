
<div class="btn-toolbar mb-4" role="toolbar">
  <div class="btn-group">    
    <button class="btn btn-outline-primary" (click)="onNew()"  >              
        <span class="oi oi-document"></span>
        <span class="ml-2">Nuovo</span>
    </button>    
    <button class="btn btn-outline-primary" [disabled]="!submissionFormDynamic.valid" (click)="onSubmit()" >              
        <span class="oi oi-arrow-top"></span>  
        <span class="ml-2">Aggiorna</span>
    </button>
    <button class="btn btn-outline-primary">
        <span class="oi oi-reload iconic" title="reload" aria-hidden="true"></span>
        <span class="ml-2">Ricarica</span>
    </button>   
    <button class="btn btn-outline-primary">
        <span class="oi oi-trash"></span>
        <span class="ml-2">Rimuovi</span>
      </button>
  </div>
</div>

<form [formGroup]="submissionFormDynamic" accept-charset="UTF-8" class="form-horizontal needs-validation"
id="form-with-validation"> 
<app-dynamic-form *ngIf="false" class="col-md-6 mb-3" [control]="submissionControls.id" [form]="submissionFormDynamic"></app-dynamic-form>
<app-dynamic-form *ngIf="false" class="col-md-6 mb-3" [control]="submissionControls.userId" [form]="submissionFormDynamic"></app-dynamic-form>
<h5>Dati personali</h5>
<div class="form-row">
  <app-dynamic-form class="col-md-6 mb-3" [control]="submissionControls.name" [form]="submissionFormDynamic"></app-dynamic-form>
  <app-dynamic-form class="col-md-6 mb-3" [control]="submissionControls.surname" [form]="submissionFormDynamic"></app-dynamic-form>
</div>

<div class="form-row">
  <app-dynamic-form class="col-md-2 mb-3" [control]="submissionControls.gender" [form]="submissionFormDynamic"></app-dynamic-form>
  <app-dynamic-form class="col-md-4 mb-3" [control]="submissionControls.fiscalcode" [form]="submissionFormDynamic"></app-dynamic-form>
  <app-dynamic-form class="col-md-6 mb-3" [control]="submissionControls.birthplace" [form]="submissionFormDynamic"></app-dynamic-form>
</div>

<div class="form-row">
  <app-dynamic-form class="col-md-6 mb-3" [control]="submissionControls.birthprovince" [form]="submissionFormDynamic"></app-dynamic-form>
  <app-dynamic-form class="col-md-6 mb-3" [control]="submissionControls.birthdate" [form]="submissionFormDynamic"></app-dynamic-form>  
</div>

<h5>Residenza</h5>
<div class="form-row">
  <app-dynamic-form class="col-md-6 mb-3" [control]="submissionControls.com_res" [form]="submissionFormDynamic"></app-dynamic-form>
  <app-dynamic-form class="col-md-6 mb-3" [control]="submissionControls.prov_res" [form]="submissionFormDynamic"></app-dynamic-form>  
</div>
<div class="form-row">
  <app-dynamic-form class="col-md-4 mb-3" [control]="submissionControls.via_res" [form]="submissionFormDynamic"></app-dynamic-form>
  <app-dynamic-form class="col-md-2 mb-3" [control]="submissionControls.civ_res" [form]="submissionFormDynamic"></app-dynamic-form>  
  <app-dynamic-form class="col-md-6 mb-3" [control]="submissionControls.presso" [form]="submissionFormDynamic"></app-dynamic-form>
</div>

<!-- <div class="mt-4">
  <app-assignment [controls]="assignmetControls" [form]="submissionFormDynamic" [control]="submissionControls.assignments" ></app-assignment>
</div> -->

<div class="mt-4">   
  <app-control-generic-list [controls]="assignmetControls" [form]="submissionFormDynamic" [control]="submissionControls.assignments">
    <ng-template let-controls="controls" let-item="item">    
      <app-assignment [controls] = "controls" [item]="item"></app-assignment>
    </ng-template>
  </app-control-generic-list> 
</div>



<div formArrayName="assignments">
  <ngx-datatable  class="bootstrap table table-striped" 
    [rows]="this.submissionFormDynamic.get('assignments').value" 
    [columnMode]="'force'"
    [rowHeight]="'auto'"   
    [headerHeight]="40"      
    [footerHeight]="40"
    [limit]="10"        
    [reorderable]="reorderable">     

    <!--[ngClass]="{'is-invalid': form.controls[control.key].invalid && (form.controls[control.key].dirty|| form.controls[control.key].touched)}"-->
    <ngx-datatable-column [name]="assignmetControls.id.label" [prop]="assignmetControls.id.key" >     
      <ng-template #textcolumn ngx-datatable-cell-template let-rowIndex="rowIndex" let-value="value" let-row="row" let-column="column"let-sort="sortFn" let-sortDir="sortDir" >                              
          <div [formGroupName]="rowIndex">
            <input autofocus class="form-control" [name]="column.prop" [formControlName]="column.prop"  type="text" [ngClass]="getCellClass(rowIndex,column)">              
          </div>
          <app-show-errors [control]="this.assignments.at(rowIndex).get(column.prop)"></app-show-errors>             
      </ng-template> 
    </ngx-datatable-column>

    <ngx-datatable-column [name]="assignmetControls.role.label" [prop]="assignmetControls.role.key" >
        <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-value="value" let-row="row" let-column="column" let-sort="sortFn" >                              
            <div [formGroupName]="rowIndex">
              <input autofocus class="form-control" [formControlName]="column.prop"  type="text" [ngClass]="getCellClass(rowIndex,column)">                
            </div>
            <app-show-errors [control]="this.assignments.at(rowIndex).get(column.prop)"></app-show-errors>             
        </ng-template>  
    </ngx-datatable-column>    

    <ngx-datatable-column [name]="assignmetControls.title.label" [prop]="assignmetControls.title.key" >
        <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-value="value" let-row="row" let-column="column" let-sort="sortFn" >                              
            <div [formGroupName]="rowIndex">
              <input autofocus class="form-control" [formControlName]="column.prop"  type="text" [ngClass]="getCellClass(rowIndex,column)">                
            </div>
            <app-show-errors [control]="this.assignments.at(rowIndex).get(column.prop)"></app-show-errors>             
        </ng-template>  
    </ngx-datatable-column> 
    
    <ngx-datatable-column [name]="assignmetControls.istitute.label" [prop]="assignmetControls.istitute.key" >
      <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-value="value" let-row="row" let-column="column"  >                              
          <div [formGroupName]="rowIndex">
            <input autofocus class="form-control" [formControlName]="column.prop"  type="text" [ngClass]="getCellClass(rowIndex,column)">                
          </div>
          <app-show-errors [control]="this.assignments.at(rowIndex).get(column.prop)"></app-show-errors>             
      </ng-template>  
    </ngx-datatable-column> 

    <ngx-datatable-column [name]="assignmetControls.from.label" [prop]="assignmetControls.from.key" >
      <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-value="value" let-row="row" let-column="column" >                              
        <div class="input-group" [formGroupName]="rowIndex">
          <input class="form-control" placeholder="dd-mm-yyyy" container='body' [formControlName]="column.prop" [id]="column.prop" [displayMonths]="displayMonths" 
              [navigation]="navigation"
              [outsideDays]="outsideDays" [showWeekNumbers]="showWeekNumbers" placement="top" ngbDatepicker #d="ngbDatepicker" 
              [ngClass]="getCellClass(rowIndex,column)">
           
            <div class="input-group-append">
              <button class="btn btn-outline-secondary" (click)="d.toggle()" type="button">
                <img src="assets/img/calendar-icon.svg" style="width: 1.2rem; height: 1rem; cursor: pointer;" />
              </button>
            </div>
         </div>
        <app-show-errors [control]="this.assignments.at(rowIndex).get(column.prop)"></app-show-errors>             
      </ng-template>  
  </ngx-datatable-column> 

  <ngx-datatable-column [name]="assignmetControls.to.label" [prop]="assignmetControls.to.key" >
    <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-value="value" let-row="row" let-column="column" >                              
      <div class="input-group" [formGroupName]="rowIndex">
        <input class="form-control" placeholder="dd-mm-yyyy" container='body' [formControlName]="column.prop" [id]="column.prop" [displayMonths]="displayMonths" 
            [navigation]="navigation"
            [outsideDays]="outsideDays" [showWeekNumbers]="showWeekNumbers" placement="top" ngbDatepicker #d="ngbDatepicker" 
            [ngClass]="getCellClass(rowIndex,column)">
          
          <div class="input-group-append">
            <button class="btn btn-outline-secondary" (click)="d.toggle()" type="button">
              <img src="assets/img/calendar-icon.svg" style="width: 1.2rem; height: 1rem; cursor: pointer;" />
            </button>
          </div>
        </div>
      <app-show-errors [control]="this.assignments.at(rowIndex).get(column.prop)"></app-show-errors>             
    </ng-template>  
  </ngx-datatable-column> 

  <ngx-datatable-column [name]="assignmetControls.document.label" [prop]="assignmetControls.document.key" >
      <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-value="value" let-row="row" let-column="column"  >                              
          <div [formGroupName]="rowIndex">
            <input autofocus class="form-control" [formControlName]="column.prop"  type="text" [ngClass]="getCellClass(rowIndex,column)">                
          </div>
          <app-show-errors [control]="this.assignments.at(rowIndex).get(column.prop)"></app-show-errors>             
      </ng-template>  
    </ngx-datatable-column> 

    <ngx-datatable-column [name]="assignmetControls.path.label" [prop]="assignmetControls.path.key" >
        <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-value="value" let-row="row" let-column="column"  >                              
            <div [formGroupName]="rowIndex">
              <input autofocus class="form-control" [formControlName]="column.prop"  type="text" [ngClass]="getCellClass(rowIndex,column)">                
            </div>
            <app-show-errors [control]="this.assignments.at(rowIndex).get(column.prop)"></app-show-errors>             
        </ng-template>  
      </ngx-datatable-column> 

  </ngx-datatable>
  



</div>
 
<p>Form value: {{ submissionFormDynamic.value | json }}</p>
<p>Form status: {{ submissionFormDynamic.status | json }}</p>
</form> 

<app-message class="mb-4"></app-message>

